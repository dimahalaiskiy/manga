name: CI

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"
          cache: "yarn"

      - name: Install dependencies
        run: yarn install --frozen-lockfile

      - name: Run linting
        run: yarn run lint || true

      - name: Build project
        run: yarn build

      - name: Deploy to Vercel
        run: |
          curl -X POST -d '{}' https://api.vercel.com/v1/integrations/deploy/prj_fsuryGcA1L3yAmrHZX0PymPuBd4V/5ASAnATa7B

      - name: Send success notification to Discord
        if: success()
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{"content": "üéâ Deployment of Mantra App PRODUCTION succeeded on Vercel! üöÄ"}' \
          https://discord.com/api/webhooks/1351285466011406356/qteE9pl7U_KJDXoArOAUjCfS3jgAvyrFgcqGhTNM4Ztw8PdlKo7pz9LYQBbB_odcZW8o

      - name: Send failure notification to Discord
        if: failure()
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{"content": "‚ùå Deployment of Mantra App PRODUCTION failed on Vercel. Please check the logs."}' \
          https://discord.com/api/webhooks/1351285466011406356/qteE9pl7U_KJDXoArOAUjCfS3jgAvyrFgcqGhTNM4Ztw8PdlKo7pz9LYQBbB_odcZW8o
